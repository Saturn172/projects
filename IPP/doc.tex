\documentclass[10pt,a4paper]{article}
\usepackage[czech]{babel}
\usepackage[latin2]{inputenc}
\usepackage[IL2]{fontenc}
\usepackage[left=2cm,text={17cm, 24cm},top=3cm]{geometry}
\usepackage{times}

\begin{document}
\pagestyle{empty}
\noindent
Implementaèní dokumentace k projektu do IPP 2017/2018\\
Jméno a pøíjmení: Daniel ©vub\\
Login: xsvubd00

\section*{\fontsize{12}{15}\selectfont parse.php}
Ze standardního vstupu jsou pomocí funkce \texttt{gets} postupnì naèítány øádky zdrojového kódu. Pokud na prvním øádku stojí validní identifikátor jazyka IPPcode18, pøedpokládá se na ka¾dém øádku korektnì napsaná instrukce nebo komentáø. Øádky pouze s komentáøi jsou ignorovány, øádky s instrukcemi jsou funkcí \texttt{explode} rozdìleny na jednotlivá slova podrobeny lexikální a syntaktické analýze (existující operaèní kód, správný poèet a správný typ argumentù). Pøípadný komentáø za korektní instrukcí je rovnì¾ ignorován.
\smallskip\\
Ke kontrole argumentù byla implementována funkce \texttt{getArg}, která ovìøí jeho typ (identifikátor promìnné, typ, label nebo konstanta urèitého typu) a validitu jeho hodnoty, a vrátí tuto hodnotu ve formátu pro export do XML. Samotný export probíhá pomocí nástroje \texttt{XMLWriter} v jeho procedurální verzi. Výsledná XML reprezentace je na standardní výstup vypsána a¾ na samotném konci analýzy, pakli¾e nedojde k ¾ádné chybì.
\smallskip\\
V rámci skriptu bylo implementováno roz¹íøení \texttt{STATP}. Na konci analýzy je vypsána hodnota poèítadla instrukcí a/nebo poèítadla komentáøù, k jeho¾ iteraci dochází pøi ka¾dé detekci symbolu \#. Soubor pro export statistik je otevírán a¾ tìsnì pøed výpisem, tak¾e v pøípadì chyby k ¾ádné manipulaci se soubory nedochází.

\section*{\fontsize{12}{15}\selectfont interpret.py}
XML reprezentace kódu je zpracována nástrojem \texttt{ElementTree}. Ten automaticky ulo¾í vstupní XML do hierarchické struktury, se kterou poté pracují zbylé èásti skriptu. Nejprve je provedena základní analýza vstupu (jde o XML kód, správná jména elementù atd.), následnì jsou nalezeny a ulo¾eny v¹echny labely v programu a nakonec je zahájena interpretace jednotlivých instrukcí jazyka IPPcode18 zavoláním funkce \texttt{execute} (provede sekvenci instrukcí od zadané instrukce dále) na celý program.
\smallskip\\
Ka¾dá instrukce je identifikována pomocí svého operaèního kódu a po kontrole její syntaktické a sémantické správnosti za pou¾ití pøedimplementovaných funkcí \texttt{Fvar} (ovìøí existenci promìnné a pøípadnì její neprázdnost) a \texttt{symb} (zpracuje symbol, pou¾ívá pøedchozí funkci) vykonána. Jde-li o skokovou instrukci, je funkce \texttt{execute} ukonèena a zavolána znovu, tentokrát nikoli na celý program, ale pouze od volaného labelu do konce.
\smallskip\\
Promìnné i labely jsou v bì¾ícím interpretu ulo¾eny ve slovnících. Databázi promìnných tvoøí globální slovník \texttt{variable} s klíèi \uv{GF}, \uv{LF} a \uv{TF}, jejich¾ hodnotami jsou vnoøené slovníky reprezentující rámce s identifikátorem promìnné jako klíèem a polem se strukturou \texttt{[type, value]} jako hodnotou. V rámci \uv{LF} je v¾dy ulo¾en vrchol zásobníku lokálních rámcù, který je implementován pomocí pole za vyu¾ití metod \texttt{append} a \texttt{pop}. Stejnì funguje datový zásobník a zásobník volání.

\section*{\fontsize{12}{15}\selectfont test.php}
Na základì pøítomnosti jednotlivých parametrù skriptu je sestaven shellový pøíkaz \texttt{find} (v pøípadì pøítomnosti parametru \texttt{--recursive} je odebrána èást \texttt{-maxdepth 1}, v pøípadì pøítomnosti \texttt{--directory} se jako cesta nastaví hodnota tohoto parametru místo výchozího aktuálního adresáøe). Pøíkaz je vykonán pomocí funkce \texttt{shell\_exec}.
\smallskip\\
Vý¹e zmínìným pøíkazem jsou nalezeny testy, které se budou provádìt. Následnì jsou vytvoøeny doèasné soubory pro ulo¾ení výstupù a otevøeny soubory \texttt{.in}, \texttt{.out} a \texttt{.rc} v pøípadì, ¾e existují. Pokud ne, jsou pou¾ity výchozí hodnoty.
\smallskip\\
V ka¾dé iteraci cyklu zahrnující v¹echny testy je vykonán skript \texttt{parse.php}, jako vstup je pou¾it soubor \texttt{.src} aktuálního testu, výstup je nasmìrován do doèasného souboru. K tomuto úèelu se pou¾ívá funkce \texttt{exec} (\texttt{shell\_exec} nevrací návratový kód ze shellu). Pokud skript nevrátil návratový kód 0, je pøezkoumáno, zda se chybový kód rovná oèekávanému chybovému kódu. Pokud ne, je vypsána chyba.
\smallskip\\
V pøípadì, ¾e \texttt{parse.php} vrátil kód 0, pokraèuje se spu¹tìním skriptu \texttt{interpret.py}. Parametrem \texttt{--source} je doèasný soubor s výstupem skriptu \texttt{parse.php}, vstupem soubor \texttt{.in} nebo prázdný øetìzec, pokud ¾ádný neexistuje, výstupem doèasný soubor. V poslední øadì je proveden shellový pøíkaz diff nad doèasným souborem s výstupem iterpretu a souborem \texttt{.out} nebo doèasným souborem bez obsahu, pokud neexistuje, a porovnán návratový kód s oèekávaným kódem.
\smallskip\\
Po skonèení cyklu je na standardní výstup vypsána HTML stránka s výsledky testù. Jednoduchá stránka obsahuje poèet vykonaných testù a poèet testù, které nepro¹ly. Jestli¾e nìkteré testy nepro¹ly, jsou vypsány takté¾ jejich názvy.

\end{document}
